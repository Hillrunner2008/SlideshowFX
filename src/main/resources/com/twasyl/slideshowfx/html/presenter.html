<!DOCTYPE html>
<!--
  ~ Copyright 2014 Thierry Wasylczenko
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~   http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<html>
<head>
    <title>SlideShowFX presenter chat</title>

    <script type="text/javascript">
        var socket;
        var opened = true;

        window.onload = function() {
            socket = new WebSocket("ws://${slideshowfx_server_ip}:${slideshowfx_server_port}/slideshowfx/chat/presenter");

            socket.onopen = function(event) {
            };

            socket.onmessage = function(event) {
                var messagesDiv = document.getElementById("messages");

                var json = JSON.parse(event.data);

                var htmlMessage = "<div class=\"chat-message\" id=\"" + json.message.id + "\">"
                                + "<span class=\"author\">" + json.message.author + " said :</span><br />"
                                + "<span class=\"message-content\">" + json.message.content + "</span></div>";

                messagesDiv.innerHTML = messagesDiv.innerHTML + htmlMessage;

                var msgDiv = document.getElementById(json.message.id);

                msgDiv.ondblclick = function(event) {
                    var json = "{ \"message\" : { \"id\" : \"" + event.target.id + "\", \"action\" : \"mark-read\" } }";
                    socket.send(json);
                };

            };
        };

        function openHideChat() {
            opened = !opened;
            scene.displayChat(opened);
        }
    </script>

    <style type="text/css">
        body {
            margin: 0;
        }
        #banner {
            width: 100%;
            height: 20px;
            background-color: red;
            color: white;

            background-image: -webkit-linear-gradient(top, #81BEF7 0%, #2E9AFE 100%);
            background-image:    -moz-linear-gradient(top, #81BEF7 0%, #2E9AFE 100%);
            background-image:     -ms-linear-gradient(top, #81BEF7 0%, #2E9AFE 100%);
            background-image:      -o-linear-gradienttop, #81BEF7 0%, #2E9AFE 100%);
            background-image:         linear-gradient(top, #81BEF7 0%, #2E9AFE 100%);
        }
        #chat {
            background-color: lightgray;
            border: 1px solid gray;
            padding: 5px;
        }
        #messages {
            margin-bottom: 5px;
            height: 300px;
            overflow: auto;
        }

        .chat-message {
            background-color: white;
            padding: 5px;
            margin: 3px;
        }
        .author {
            font-weight: bold;
        }
        .message-content {
            font-style: italic;
        }
    </style>
</head>
<body>
    <div id="slideshowfx-chat">
        <div id="banner" onclick="javascript:openHideChat();">Chat @ ${slideshowfx_server_ip}:${slideshowfx_server_port}</div>
        <div id="chat">
            <div id="messages"></div>
        </div>
    </div>

</body>
</html>